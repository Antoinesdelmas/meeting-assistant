<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Meeting Mind</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --bg: #0a0a0a;
      --surface: #111111;
      --surface2: #1a1a1a;
      --border: #2a2a2a;
      --accent: #c8f135;
      --accent2: #f1c135;
      --text: #f0ede6;
      --muted: #666;
      --red: #ff4444;
      --radius: 12px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'DM Mono', monospace;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 32px 40px 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      font-family: 'DM Serif Display', serif;
      font-size: 28px;
      letter-spacing: -0.5px;
      color: var(--text);
    }

    .logo span { color: var(--accent); font-style: italic; }

    .status-pill {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 16px;
      border-radius: 100px;
      border: 1px solid var(--border);
      font-size: 12px;
      color: var(--muted);
      transition: all 0.3s;
    }

    .status-pill.recording {
      border-color: var(--red);
      color: var(--red);
      background: rgba(255,68,68,0.08);
    }

    .status-dot {
      width: 7px; height: 7px;
      border-radius: 50%;
      background: var(--muted);
      transition: all 0.3s;
    }

    .status-pill.recording .status-dot {
      background: var(--red);
      animation: pulse 1.2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.4; transform: scale(0.8); }
    }

    main {
      flex: 1;
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: auto 1fr;
      gap: 1px;
      background: var(--border);
      overflow: hidden;
    }

    .panel {
      background: var(--bg);
      padding: 32px 36px;
      overflow-y: auto;
    }

    .panel-header {
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 20px;
    }

    /* Controls panel - full width top */
    .controls-panel {
      grid-column: 1 / -1;
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 24px 36px;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
    }

    .btn-record {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 14px 28px;
      border-radius: var(--radius);
      border: none;
      background: var(--accent);
      color: #000;
      font-family: 'DM Mono', monospace;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      letter-spacing: 0.5px;
    }

    .btn-record:hover { background: #d4f545; transform: translateY(-1px); }

    .btn-record.recording {
      background: var(--red);
      color: #fff;
    }

    .btn-record.recording:hover { background: #ff5555; }

    .btn-analyze {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 14px 28px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text);
      font-family: 'DM Mono', monospace;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
      letter-spacing: 0.5px;
    }

    .btn-analyze:hover:not(:disabled) {
      border-color: var(--accent2);
      color: var(--accent2);
      transform: translateY(-1px);
    }

    .btn-analyze:disabled { opacity: 0.3; cursor: not-allowed; }

    .btn-clear {
      margin-left: auto;
      padding: 10px 20px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: transparent;
      color: var(--muted);
      font-family: 'DM Mono', monospace;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-clear:hover { border-color: var(--muted); color: var(--text); }

    .timer {
      font-family: 'DM Serif Display', serif;
      font-size: 22px;
      color: var(--muted);
      letter-spacing: 2px;
      transition: color 0.3s;
    }

    .timer.active { color: var(--red); }

    /* Transcript panel */
    #transcript-box {
      min-height: 200px;
      background: var(--surface2);
      border-radius: var(--radius);
      padding: 20px;
      font-size: 14px;
      line-height: 1.8;
      color: var(--text);
      border: 1px solid var(--border);
      white-space: pre-wrap;
      word-break: break-word;
    }

    #transcript-box.empty {
      color: var(--muted);
      font-style: italic;
    }

    #interim-text {
      color: var(--muted);
      font-style: italic;
    }

    /* Analysis panel */
    #analysis-box {
      min-height: 200px;
    }

    .loading-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 16px;
      padding: 60px 20px;
      color: var(--muted);
      font-size: 13px;
    }

    .spinner {
      width: 32px; height: 32px;
      border: 2px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .analysis-section {
      margin-bottom: 28px;
    }

    .analysis-section h3 {
      font-family: 'DM Serif Display', serif;
      font-size: 16px;
      font-style: italic;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .analysis-section h3 .icon {
      font-style: normal;
      font-size: 18px;
    }

    .analysis-section.good h3 { color: var(--accent); }
    .analysis-section.avoid h3 { color: var(--red); }
    .analysis-section.steps h3 { color: var(--accent2); }
    .analysis-section.behavior h3 { color: #a78bfa; }
    .analysis-section.summary h3 { color: var(--text); }

    .analysis-section p, .analysis-section li {
      font-size: 13px;
      line-height: 1.8;
      color: #bbb;
    }

    .analysis-section ul {
      padding-left: 16px;
    }

    .analysis-section li {
      margin-bottom: 6px;
    }

    .tag {
      display: inline-block;
      padding: 2px 10px;
      border-radius: 100px;
      font-size: 11px;
      letter-spacing: 1px;
      margin-bottom: 12px;
    }

    .tag.good { background: rgba(200,241,53,0.12); color: var(--accent); border: 1px solid rgba(200,241,53,0.25); }
    .tag.avoid { background: rgba(255,68,68,0.1); color: var(--red); border: 1px solid rgba(255,68,68,0.2); }
    .tag.steps { background: rgba(241,193,53,0.1); color: var(--accent2); border: 1px solid rgba(241,193,53,0.2); }
    .tag.behavior { background: rgba(167,139,250,0.1); color: #a78bfa; border: 1px solid rgba(167,139,250,0.2); }

    .empty-analysis {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 60px 20px;
      text-align: center;
    }

    .empty-analysis .big-icon { font-size: 40px; opacity: 0.3; }
    .empty-analysis p { color: var(--muted); font-size: 13px; line-height: 1.7; }

    .word-count {
      font-size: 11px;
      color: var(--muted);
      margin-top: 10px;
    }

    /* API key input */
    .api-key-bar {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 36px;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
    }

    .api-key-bar label {
      font-size: 11px;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--muted);
      white-space: nowrap;
    }

    .api-key-bar input {
      flex: 1;
      max-width: 400px;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 14px;
      font-family: 'DM Mono', monospace;
      font-size: 12px;
      color: var(--text);
      outline: none;
    }

    .api-key-bar input:focus { border-color: var(--accent); }

    .api-note {
      font-size: 11px;
      color: var(--muted);
    }

    @media (max-width: 768px) {
      main { grid-template-columns: 1fr; }
      .controls-panel { flex-wrap: wrap; }
      header { padding: 20px; }
      .panel { padding: 20px; }
    }
  </style>
</head>
<body>

<header>
  <div class="logo">Meeting <span>Mind</span></div>
  <div class="status-pill" id="status-pill">
    <div class="status-dot"></div>
    <span id="status-text">Ready</span>
  </div>
</header>

<div class="api-key-bar">
  <label>Claude API Key</label>
  <input type="password" id="api-key" placeholder="sk-ant-..." />
  <span class="api-note">Stored locally in your browser only</span>
</div>

<div class="controls-panel">
  <select id="lang-select" style="background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:10px 14px;color:var(--text);font-family:'DM Mono',monospace;font-size:12px;cursor:pointer;outline:none;">
    <option value="en-US">üá¨üáß English</option>
    <option value="fr-FR">üá´üá∑ Fran√ßais</option>
  </select>
  <button class="btn-record" id="btn-record" onclick="toggleRecording()">
    <span id="btn-icon">‚è∫</span>
    <span id="btn-label">Start Recording</span>
  </button>
  <button class="btn-analyze" id="btn-analyze" onclick="analyzeTranscript()" disabled>
    ‚ú¶ Analyze Meeting
  </button>
  <div class="timer" id="timer">00:00</div>
  <button class="btn-clear" onclick="clearAll()">‚Ü∫ Clear</button>
</div>

<main>
  <div class="panel">
    <div class="panel-header">Live Transcript</div>
    <div id="transcript-box" class="empty">
      Press <strong>Start Recording</strong> and speak ‚Äî your meeting will be transcribed here in real time...
    </div>
    <div class="word-count" id="word-count"></div>
  </div>

  <div class="panel">
    <div class="panel-header">AI Analysis</div>
    <div id="analysis-box">
      <div class="empty-analysis">
        <div class="big-icon">üß†</div>
        <p>Record your meeting, then click<br/><strong>Analyze Meeting</strong> to get behavioral insights,<br/>next steps, and communication feedback.</p>
      </div>
    </div>
  </div>
</main>

<script>
  let recognition = null;
  let isRecording = false;
  let finalTranscript = '';
  let timerInterval = null;
  let seconds = 0;

  // Load saved API key
  const apiKeyInput = document.getElementById('api-key');
  apiKeyInput.value = localStorage.getItem('claude_api_key') || '';
  apiKeyInput.addEventListener('change', () => {
    localStorage.setItem('claude_api_key', apiKeyInput.value);
  });

  function toggleRecording() {
    if (isRecording) stopRecording();
    else startRecording();
  }

  function startRecording() {
    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
      alert('Speech recognition is not supported in this browser. Please use Chrome or Edge.');
      return;
    }

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.continuous = true;
    recognition.interimResults = true;
    recognition.lang = document.getElementById('lang-select').value;

    recognition.onstart = () => {
      isRecording = true;
      updateUI();
      startTimer();
    };

    recognition.onresult = (event) => {
      let interim = '';
      for (let i = event.resultIndex; i < event.results.length; i++) {
        const transcript = event.results[i][0].transcript;
        if (event.results[i].isFinal) {
          finalTranscript += transcript + ' ';
        } else {
          interim += transcript;
        }
      }
      renderTranscript(interim);
    };

    recognition.onerror = (event) => {
      console.error('Speech recognition error:', event.error);
      if (event.error === 'not-allowed') {
        alert('Microphone access was denied.\n\nPlease:\n1. Click the üîí icon in your browser address bar\n2. Allow microphone access\n3. Refresh the page and try again');
        isRecording = false;
        stopTimer();
        updateUI();
      }
    };

    recognition.onend = () => {
      if (isRecording) {
        setTimeout(() => {
          try { recognition.start(); } catch(e) {}
        }, 200);
      }
    };

    recognition.start();
  }

  function stopRecording() {
    isRecording = false;
    if (recognition) recognition.stop();
    stopTimer();
    updateUI();
    renderTranscript('');
  }

  function renderTranscript(interim) {
    const box = document.getElementById('transcript-box');
    box.classList.remove('empty');

    const words = finalTranscript.trim().split(/\s+/).filter(Boolean);
    document.getElementById('word-count').textContent = `${words.length} words`;

    box.innerHTML = finalTranscript +
      (interim ? `<span id="interim-text">${interim}</span>` : '');

    box.scrollTop = box.scrollHeight;

    document.getElementById('btn-analyze').disabled = words.length < 10;
  }

  function updateUI() {
    const pill = document.getElementById('status-pill');
    const dot = pill.querySelector('.status-dot');
    const statusText = document.getElementById('status-text');
    const btnIcon = document.getElementById('btn-icon');
    const btnLabel = document.getElementById('btn-label');
    const btn = document.getElementById('btn-record');
    const timer = document.getElementById('timer');

    if (isRecording) {
      pill.classList.add('recording');
      statusText.textContent = 'Recording';
      btnIcon.textContent = '‚èπ';
      btnLabel.textContent = 'Stop Recording';
      btn.classList.add('recording');
      timer.classList.add('active');
    } else {
      pill.classList.remove('recording');
      statusText.textContent = finalTranscript ? 'Stopped' : 'Ready';
      btnIcon.textContent = '‚è∫';
      btnLabel.textContent = 'Start Recording';
      btn.classList.remove('recording');
      timer.classList.remove('active');
    }
  }

  function startTimer() {
    seconds = 0;
    timerInterval = setInterval(() => {
      seconds++;
      const m = String(Math.floor(seconds / 60)).padStart(2, '0');
      const s = String(seconds % 60).padStart(2, '0');
      document.getElementById('timer').textContent = `${m}:${s}`;
    }, 1000);
  }

  function stopTimer() {
    clearInterval(timerInterval);
  }

  function clearAll() {
    if (isRecording) stopRecording();
    finalTranscript = '';
    seconds = 0;
    document.getElementById('timer').textContent = '00:00';
    document.getElementById('word-count').textContent = '';
    const box = document.getElementById('transcript-box');
    box.innerHTML = 'Press <strong>Start Recording</strong> and speak ‚Äî your meeting will be transcribed here in real time...';
    box.classList.add('empty');
    document.getElementById('btn-analyze').disabled = true;
    document.getElementById('analysis-box').innerHTML = `
      <div class="empty-analysis">
        <div class="big-icon">üß†</div>
        <p>Record your meeting, then click<br/><strong>Analyze Meeting</strong> to get behavioral insights,<br/>next steps, and communication feedback.</p>
      </div>`;
    updateUI();
  }

  async function analyzeTranscript() {
    const apiKey = document.getElementById('api-key').value.trim();
    if (!apiKey) {
      alert('Please enter your Claude API key at the top.');
      return;
    }

    if (!finalTranscript.trim()) {
      alert('No transcript to analyze.');
      return;
    }

    const analysisBox = document.getElementById('analysis-box');
    analysisBox.innerHTML = `<div class="loading-state"><div class="spinner"></div><span>Analyzing your meeting...</span></div>`;
    document.getElementById('btn-analyze').disabled = true;

    const prompt = `You are an expert in human behavior, communication dynamics, and meeting effectiveness. The transcript may be in English or French ‚Äî detect the language and respond in the SAME language as the transcript. Analyze this meeting transcript and provide structured insights.

TRANSCRIPT:
"""
${finalTranscript}
"""

Provide your analysis in this exact JSON format:
{
  "summary": "2-3 sentence overview of what this meeting was about and the general dynamic",
  "behavior_patterns": ["insight 1", "insight 2", "insight 3"],
  "what_went_well": ["point 1", "point 2", "point 3"],
  "what_to_avoid": ["point 1", "point 2", "point 3"],
  "next_steps": ["action 1", "action 2", "action 3"],
  "communication_score": 75
}

Focus on: power dynamics, listening vs talking balance, emotional tone, decision-making patterns, clarity of communication, and interpersonal dynamics. Be specific and actionable.`;

    try {
      const response = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-api-key': apiKey,
          'anthropic-version': '2023-06-01',
          'anthropic-dangerous-direct-browser-access': 'true'
        },
        body: JSON.stringify({
          model: 'claude-opus-4-6',
          max_tokens: 1000,
          messages: [{ role: 'user', content: prompt }]
        })
      });

      const data = await response.json();

      if (data.error) throw new Error(data.error.message);

      const text = data.content[0].text;
      const jsonMatch = text.match(/\{[\s\S]*\}/);
      if (!jsonMatch) throw new Error('Could not parse response');

      const analysis = JSON.parse(jsonMatch[0]);
      renderAnalysis(analysis);

    } catch (err) {
      analysisBox.innerHTML = `<div class="loading-state" style="color:#ff4444">‚ö† Error: ${err.message}<br/><small style="color:#666;margin-top:8px;display:block">Check your API key and try again.</small></div>`;
    } finally {
      document.getElementById('btn-analyze').disabled = false;
    }
  }

  function renderAnalysis(a) {
    const score = a.communication_score || 70;
    const scoreColor = score >= 75 ? 'var(--accent)' : score >= 50 ? 'var(--accent2)' : 'var(--red)';

    document.getElementById('analysis-box').innerHTML = `
      <div class="analysis-section summary">
        <h3><span class="icon">üìã</span> Summary</h3>
        <p>${a.summary}</p>
        <div style="margin-top:14px;display:flex;align-items:center;gap:12px">
          <span style="font-size:11px;color:var(--muted);letter-spacing:1px;text-transform:uppercase">Communication Score</span>
          <span style="font-family:'DM Serif Display',serif;font-size:22px;color:${scoreColor}">${score}/100</span>
        </div>
      </div>

      <div class="analysis-section behavior">
        <h3><span class="icon">üîç</span> Behavior Patterns</h3>
        <span class="tag behavior">BEHAVIORAL INSIGHT</span>
        <ul>${a.behavior_patterns.map(i => `<li>${i}</li>`).join('')}</ul>
      </div>

      <div class="analysis-section good">
        <h3><span class="icon">‚úì</span> What Went Well</h3>
        <span class="tag good">STRENGTHS</span>
        <ul>${a.what_went_well.map(i => `<li>${i}</li>`).join('')}</ul>
      </div>

      <div class="analysis-section avoid">
        <h3><span class="icon">‚úó</span> What to Avoid Next Time</h3>
        <span class="tag avoid">WATCH OUT</span>
        <ul>${a.what_to_avoid.map(i => `<li>${i}</li>`).join('')}</ul>
      </div>

      <div class="analysis-section steps">
        <h3><span class="icon">‚Üí</span> Next Steps</h3>
        <span class="tag steps">ACTION ITEMS</span>
        <ul>${a.next_steps.map(i => `<li>${i}</li>`).join('')}</ul>
      </div>
    `;
  }
</script>
</body>
</html>
